---
title: "Impact on Field Surface and Player Injuries"
author: "Matthew Wilcox, Randy Otoo, Logan Lapace"
output: html_document
---

# Introduction

This year fans of the NFL have watched their favorite teams compete week-in and week out. However many fans are saddened and angered that they have been unable to watch their favorite players play not being on the field due to injuries. Especially after Aaron Rodgers tore his Achilles in the first game of the season, The NFLPA executive director Lloyd Howell called upon all NFL owners to convert their stadium from turf to grass according to ESPN. With this recent outcry for the switch we want to see if their is correlation between the field surface and the injuries while comparing it with a variety of factors.

```{r}
library(data.table)
library(tidyverse)
```

# Data Descrition

```{r}
injury_data <- fread("InjuryRecord.csv")

PlayerTD <- fread("PlayerTrackData.csv")

PlayList <- fread("PlayList.csv")
```
https://www.kaggle.com/competitions/nfl-playing-surface-analytics/data
The data was aquired through the NFL 1st and Future - Analytics Kaggle Competion. This was a competition Hosted in 2019 by the NFL to investigate the relationship between the playing surface and the injury and performance of NFL Athletes. This provided Three datasets. The first consisted of the injuries. This provided us with the Injury type, the player/play it occured on, and how long that player was out after that injury. The second data set was of the player telementry data. This data provided information such as speed of the player and movement of that player for individual plays. The final dataset gave us data on the plays. It showed the person involved in the play, what type of play was it, weather at the time of the play and finally the field surface. 

# Data Cleaning 

# Lower Body Injury Comparison
```{r}
view(injury_data)
injury_data %>% 
  ggplot(aes(BodyPart,
              fill = Surface)) +
  geom_bar(position = "dodge", alpha = 1)+
  theme_bw()+
  theme( panel.grid.major = element_blank(),
         panel.grid.minor = element_blank()) +
  labs(x = "Body Part",
       y = "Number",
       title = "Lower Body Injury Comparison") 
  



```

Based on the bar graph, we could see that while there was a greater incidence of knee injuries on both natural and synthetic grass fields, there were more ankle injuries on synthetic turfs. Surprisingly, heel injuries tended to happen on natural fields rather than synthetic ones. Although there were fewer foot and toe injuries, the likelihood of sustaining a toe injury on a synthetic pitch was higher than that of a foot injury on a natural grass field.  



```{r}


```




```{r}
  library(ggplot2)
  library(gridExtra)


# Set plotting area into a 2*3 array
par(mfrow = c(2,3))

k.injury_df <- injury_data %>% filter(BodyPart == "Knee")

k.injury_df <- k.injury_df %>%
  select(BodyPart, Surface) %>%
  group_by(Surface) %>%
  summarise(prop = n()/nrow(k.injury_df))

k.injury.plot <- ggplot(k.injury_df, aes(x = "", y = prop, fill =  Surface)) + 
  geom_bar(stat = "identity", width = 1)+
  coord_polar("y", start = 0)
k.injury_df



a.injury_df <- injury_data %>% filter(BodyPart == "Ankle")

a.injury_df <- a.injury_df %>%
  select(BodyPart, Surface) %>%
  group_by(Surface) %>%
  summarise(prop = n()/nrow(a.injury_df))

a.injury.plot<- ggplot(a.injury_df, aes(x = "", y = prop, fill =  Surface)) + 
  geom_bar(stat = "identity", width = 1)+
  coord_polar("y", start = 0)
a.injury_df


t.injury_df <- injury_data %>% filter(BodyPart == "Toes")

t.injury_df <- t.injury_df %>%
  select(BodyPart, Surface) %>%
  group_by(Surface) %>%
  summarise(prop = n()/nrow(t.injury_df))

t.injury.plot <- ggplot(t.injury_df, aes(x = "", y = prop, fill =  Surface)) + 
  geom_bar(stat = "identity", width = 1)+
  coord_polar("y", start = 0)

t.injury_df


t.injury_df <- injury_data %>% filter(BodyPart == "Toes")

t.injury_df <- t.injury_df %>%
  select(BodyPart, Surface) %>%
  group_by(Surface) %>%
  summarise(prop = n()/nrow(t.injury_df))

t.injury.plot <- ggplot(t.injury_df, aes(x = "", y = prop, fill =  Surface)) + 
  geom_bar(stat = "identity", width = 1)+
  coord_polar("y", start = 0)
t.injury_df

  
f.injury_df <- injury_data %>% filter(BodyPart == "Foot")

f.injury_df <- f.injury_df %>%
  select(BodyPart, Surface) %>%
  group_by(Surface) %>%
  summarise(prop = n()/nrow(f.injury_df))

f.injury.plot <- ggplot(f.injury_df, aes(x = "", y = prop, fill =  Surface)) + 
  geom_bar(stat = "identity", width = 1)+
  coord_polar("y", start = 0)
f.injury_df


h.injury_df <- injury_data %>% filter(BodyPart == "Heel")

h.injury_df <- h.injury_df %>%
  select(BodyPart, Surface) %>%
  group_by(Surface) %>%
  summarise(prop = n()/nrow(h.injury_df))

h.injury.plot <- ggplot(h.injury_df, aes(x = "", y = prop, fill =  Surface)) + 
  geom_bar(stat = "identity", width = 1)+
  coord_polar("y", start = 0)
h.injury_df

 
grid.arrange(k.injury.plot, 
             a.injury.plot,
             t.injury.plot, 
             f.injury.plot, 
             h.injury.plot, 
             nrow = 3, ncol = 3)

  
 




```




# Surface impact on Injury Day

```{r}
injury_data %>%
  ggplot(aes(DM_M28,
             color = BodyPart,
             fill = BodyPart)) +
  geom_density(alpha = 0.4 , show.legend = F) +
  facet_grid(Surface ~ BodyPart) +
  labs(title = "Surface impact on Injury Day",
       x = "Day out for Injury",
       y = "") +
  theme_bw()





```







# Surface and Weather

# Player Movement and the Field Surface


```{r}
get_max_play <- function(input_df, play_col, play_val, max_column){
  df <- input_df %>% filter(!!as.symbol(play_col) == {{play_val}})
  max.val <- max(df[[max_column]])
  max.val
}
```

```{r}
Injury_speeds <- lapply(as.list(injury_data$PlayKey), get_max_play, input_df = PlayerTD, play_col="PlayKey", max_column = "s")
injury_data$Speeds <- Injury_speeds

```

```{r}
injury_data <- na.omit(injury_data)
injury_data <- injury_data %>%
  select(BodyPart, Surface, Speeds)
injury_data$Speeds <- as.numeric(injury_data$Speeds)
injury_data <- injury_data[injury_data$Speeds >= 0]
injury_data
```

```{r}
library(gridExtra)
speed_synthetic <-ggplot(injury_data[injury_data$Surface == "Synthetic"], aes(x=Speeds)) +
  geom_histogram(bins = 10) +
  ggtitle("Speed at Injury on Synthetic")
speed_Natural <- ggplot(injury_data[injury_data$Surface == "Natural"], aes(x=Speeds))+
  geom_histogram(bins = 10)+
  ggtitle("Speed at Injury on Natural")
grid.arrange(speed_synthetic, speed_Natural, nrow = 1)
```

```{r}
ggplot(injury_data, aes(x = Surface, y = Speeds)) + geom_boxplot()
```
# Percentage of Games Played previously on Turf and Injury
