---
title: "Impact on Field Surface and Player Injuries"
author: "Matthew Wilcox, Randy Otoo, Logan Lapace"
output: html_document
---

# Introduction

This year fans of the NFL have watched their favorite teams compete week-in and week out. However many fans are saddened and angered that they have been unable to watch their favorite players play not being on the field due to injuries. Especially after Aaron Rodgers tore his Achilles in the first game of the season, The NFLPA executive director Lloyd Howell called upon all NFL owners to convert their stadium from turf to grass according to ESPN. With this recent outcry for the switch we want to see if their is correlation between the field surface and the injuries while comparing it with a variety of factors.

```{r}
library(data.table)
library(tidyverse)
library(magrittr)
library(knitr)
library(kableExtra)
```

# Data Descrition

```{r}
injury_data <- fread("InjuryRecord.csv")

PlayerTD <- fread("PlayerTrackData.csv")

PlayList <- fread("PlayList.csv")
```
https://www.kaggle.com/competitions/nfl-playing-surface-analytics/data
The data was aquired through the NFL 1st and Future - Analytics Kaggle Competion. This was a competition Hosted in 2019 by the NFL to investigate the relationship between the playing surface and the injury and performance of NFL Athletes. This provided Three datasets. The first consisted of the injuries. This provided us with the Injury type, the player/play it occured on, and how long that player was out after that injury. The second data set was of the player telementry data. This data provided information such as speed of the player and movement of that player for individual plays. The final dataset gave us data on the plays. It showed the person involved in the play, what type of play was it, weather at the time of the play and finally the field surface. 

# Data Cleaning 
# look for nulls and missing data, summarize: how many missing values per column. ex: no play number for an injury where player didnt exit on a particular play
```{r}
null_values <- function(data, name) {
  
  data[data == ""] <- NA
  null_counts <- colSums(is.na(data))
  data_name <- name
  x = paste("Null Value Counts by Column: ",data_name) 
  result_null_check <- data.frame(Column = names(null_counts), NullCount = null_counts)

  # Print the formatted table using kable and kableExtra
  result_table <- result_null_check %>%
    kable("html", align = c("l", "c"), caption = x , col.names = c("Column", "NullCount"), row.names = FALSE) %>%
    kable_styling(full_width = FALSE)
  
  return(result_table)
}
```

```{r}
null_values(injury_data, 'injury_data')
```


```{r}
null_values(PlayerTD, 'PlayerTD')
```

```{r}
null_values(PlayList, 'PlayList')
```

Lower Body Injury Comparison

# Surface impact on Injury Day

# Surface and Weather
#analyze injuries see if trend between certain surfaces and weather and injuries


```{r}
merged_data <- merge(injury_data, PlayList, by = c("PlayerKey", "GameID", "PlayKey"))

merged_data <- merge(merged_data, PlayerTD, by = "PlayKey")

#distribution of injuries by field type
ggplot(merged_data, aes(x = FieldType, fill = BodyPart)) +
  geom_bar(position = "stack") +
  labs(title = "Injuries by Field Type and Body Part")

#distribution of injuries by field type as proportions
ggplot(merged_data, aes(x = FieldType, fill = BodyPart)) +
  geom_bar(position = "fill") +
  labs(title = "Proportion of Injuries by Field Type and Body Part")
```
#The first plot shows absolute injury counts stacked by body part, while the second plot presents proportions of injuries by body part within each field type. If "FieldType" refers to playing surface, a preliminary observation suggests that synthetic turf may have a higher overall injury count, with the second plot indicating a potential association between synthetic turf and a higher proportion of ankle injuries compared to natural turf.
```{r}
ggplot(merged_data, aes(x = Weather, fill = BodyPart)) +
  geom_bar(position = "stack") +
  labs(title = "Injuries by Weather and Body Part") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotate x-axis labels

ggplot(merged_data, aes(x = FieldType, fill = BodyPart)) +
  geom_bar(position = "stack") +
  facet_wrap(~Weather) +
  labs(title = "Injuries by Field Type and Body Part (Faceted by Weather)")

ggplot(merged_data, aes(x = FieldType, fill = BodyPart)) +
  geom_bar(position = "fill") +  # Use position = "fill" for proportions
  facet_wrap(~Weather, scales = "free_y") +  # Use scales = "free_y" for independent y-axes
  labs(title = "Proportions of Injuries by Field Type and Body Part (Faceted by Weather)")


# Heatmap for the correlation between field types, weather, and injuries
correlation_matrix <- table(merged_data$FieldType, merged_data$Weather)
heatmap(correlation_matrix, main = "Correlation Heatmap", 
        xlab = "Weather", ylab = "FieldType", col = heat.colors(12))



```
# A stacked bar plot, visualizing the distribution of injuries by weather conditions and body parts. the data reveals elevated injury counts under weather conditions characterized by reduced visibility, such as cloudy, partly cloudy, and sunny conditions. This observation prompts further exploration into the potential correlation between weather patterns impacting visibility and the occurrence of injuries.

#The first plot provides a stacked bar chart depicting the distribution of injuries across body parts on different field types under various weather conditions. The second plot displays proportions of injuries with independent y-axes, emphasizing the relative contribution of body parts on distinct field types during different weather conditions. Notably, the observations suggest a clear correlation between synthetic turf and ankle injuries. Furthermore, the heightened correlation between low visibility weather conditions and injuries appears more pronounced for natural turf fields. Indoor fields are almost always Synthetic turf, so low visibility conditions are not going to apply very often to turf fields.

#A heatmap showcasing the correlation between field types, weather conditions, and injuries in the merged dataset. The heatmap, titled "Correlation Heatmap," visually confirms and reinforces the earlier observations from the preceding analyses and visualizations, providing a succinct summary of the interconnected factors influencing injury patterns. Injuries are more evenly distrubuted across all weather conditions for turf fields (which happen to be indoors more often), while we notice a skew in the heat map for natural turf fields.

```

